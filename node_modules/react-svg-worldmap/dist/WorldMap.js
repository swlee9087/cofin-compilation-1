"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.WorldMap=void 0;const React=require("react"),d3_geo_1=require("d3-geo"),react_path_tooltip_1=require("react-path-tooltip"),countries_geo_1=require("./countries.geo"),CDefaultColor="#dddddd",CSizes={sm:240,md:336,lg:480,xl:640,xxl:1200,responsive:-1},CHeightRatio=3/4;exports.WorldMap=e=>{const t=(()=>{const[e,t]=React.useState(0);return React.useLayoutEffect((()=>{const e=()=>{t(window.innerWidth)};return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)}),[]),e})(),o=void 0!==e.size?e.size:"sm",r=e=>{let o=e;if("responsive"===e)return.75*Math.min(window.innerHeight,window.innerWidth);for(;CSizes[o]>t;){if("sm"===o)return CSizes.sm;"md"===o?o="sm":"lg"===o?o="md":"xl"===o?o="lg":"xxl"===o&&(o="xl")}return CSizes[o]},i=r(o),a=.75*r(o),l=void 0===e.valuePrefix?"":e.valuePrefix,n=void 0===e.valueSuffix?"":e.valueSuffix,c=void 0===e.tooltipBgColor?"black":e.tooltipBgColor,u=void 0===e.tooltipTextColor?"white":e.tooltipTextColor,d=void 0!==e.frame&&e.frame,s=void 0===e.backgroundColor?"white":e.backgroundColor,p=void 0===e.strokeOpacity?.2:e.strokeOpacity,g=void 0===e.frameColor?"black":e.frameColor,h=void 0===e.borderColor?"black":e.borderColor,m=d?React.createElement("rect",{x:0,y:0,width:"100%",height:"100%",stroke:g,fill:"none"}):React.createElement("path",null),y=void 0===e.title?"":React.createElement("p",null,e.title),f=`scale(${(i/960).toString()}) translate (0,240)`,v=React.createRef(),x={};let C=-1/0,k=1/0;e.data.forEach((e=>{const t=e.country.toUpperCase(),{value:o}=e;k=k>o?o:k,C=C<o?o:C,x[t]=o}));const _=d3_geo_1.geoMercator(),R=d3_geo_1.geoPath().projection(_),w=countries_geo_1.default.features.map(((t,o)=>{const r=React.createRef(),i=t.I,a=t.N,d={type:"Feature",properties:{NAME:a,ISO_A2:i},geometry:{type:"MultiPolygon",coordinates:t.C}},s=void 0!==x[i],g=e.styleFunction&&s?e.styleFunction({country:i,countryValue:x[i],color:e.color?e.color:"#dddddd",minValue:k,maxValue:C}):(e=>{const t=e.countryValue?e.countryValue:0,o=.2+(t-e.minValue)/(e.maxValue-e.minValue)*.6;return{fill:e.color,fillOpacity:0===t?t:o,stroke:h,strokeWidth:1,strokeOpacity:p,cursor:"pointer"}})({country:i,countryValue:x[i],color:e.color?e.color:"#dddddd",minValue:k,maxValue:C}),m=React.createElement("path",{key:`path${o}`,ref:r,d:R(d),style:g,onClick:t=>{e.onClickFunction&&x[i]&&e.onClickFunction(t,a,i,x[i].toString(),l||"",n||"")},onMouseOver:e=>{e.currentTarget.style.strokeWidth="2",e.currentTarget.style.strokeOpacity="0.5"},onMouseOut:e=>{e.currentTarget.style.strokeWidth="1",e.currentTarget.style.strokeOpacity=`${p}`}});let y="";e.tooltipTextFunction&&x[i]?y=e.tooltipTextFunction(a,i,x[i].toString(),l||"",n||""):x[i]&&(y=`${a} ${l} ${x[i].toLocaleString()} ${n}`);return{path:m,highlightedTooltip:s?React.createElement(react_path_tooltip_1.PathTooltip,{fontSize:12,bgColor:c,textColor:u,key:`path_${o}_xyz`,pathRef:r,svgRef:v,tip:y}):React.createElement("g",{pointerEvents:"none",key:`path${o}xyz`})}})),E=w.map((e=>e.path)),S=w.map((e=>e.highlightedTooltip));return React.createElement("div",{style:{backgroundColor:s,height:"auto",width:"auto",padding:"0px",margin:"0px"}},y,React.createElement("svg",{ref:v,height:`${a}px`,width:`${i}px`},m,React.createElement("g",{transform:f},E),S))};